<div class="container-panel">
  <div class="header">
    <h1>ğŸŒ¿ Panel de ValidaciÃ³n ONG</h1>
    <p class="subtitle">Revisa y aprueba actividades de reciclaje con evidencia en blockchain</p>
    <button class="btn-refresh" (click)="cargarPropuestas()" [disabled]="cargando">
      <span *ngIf="!cargando">ğŸ”„ Actualizar</span>
      <span *ngIf="cargando">â³ Cargando...</span>
    </button>
  </div>

  <!-- Indicador de carga -->
  <div *ngIf="cargando" class="loading">
    <div class="spinner"></div>
    <p>Cargando propuestas pendientes...</p>
  </div>

  <!-- Lista vacÃ­a -->
  <div *ngIf="!cargando && propuestasPendientes.length === 0" class="empty-state">
    <div class="empty-icon">âœ…</div>
    <h3>No hay propuestas pendientes</h3>
    <p>Todas las actividades han sido procesadas</p>
  </div>

  <!-- Lista de propuestas -->
  <div *ngIf="!cargando && propuestasPendientes.length > 0" class="propuestas-grid">
    <div *ngFor="let propuesta of propuestasPendientes" class="propuesta-card">

      <!-- Header de la tarjeta -->
      <div class="card-header">
        <span class="badge-id">Actividad #{{propuesta.actividadId}}</span>
        <span class="badge-aprobaciones">{{propuesta.aprobaciones}}/2 Aprobaciones</span>
      </div>

      <!-- Evidencia IPFS -->
      <div class="evidencia-container" *ngIf="isValidIPFS(propuesta.evidenciaIPFS)">
        <img [src]="getIPFSUrl(propuesta.evidenciaIPFS)" alt="Evidencia IPFS" class="evidencia-img"
          (click)="verEvidenciaCompleta(propuesta.evidenciaIPFS)" />
        <div class="ipfs-overlay">
          <span class="ipfs-hash">ğŸ“ {{propuesta.evidenciaIPFS.substring(0, 15)}}...</span>
          <button class="btn-ver-completa" (click)="verEvidenciaCompleta(propuesta.evidenciaIPFS)">
            ğŸ” Ver completa
          </button>
        </div>
      </div>

      <div class="evidencia-placeholder" *ngIf="!isValidIPFS(propuesta.evidenciaIPFS)">
        <span>âš ï¸ Evidencia no disponible</span>
      </div>

      <!-- InformaciÃ³n de la actividad -->
      <div class="info-section">
        <div class="info-row">
          <span class="label">ğŸ‘¤ Usuario:</span>
          <span class="value">{{propuesta.usuarioWallet.substring(0,
            10)}}...{{propuesta.usuarioWallet.substring(38)}}</span>
        </div>

        <div class="info-row">
          <span class="label">â™»ï¸ Material:</span>
          <span class="value material-badge">{{getNombreMaterial(propuesta.tipoMaterial)}}</span>
        </div>

        <div class="info-row">
          <span class="label">âš–ï¸ Peso:</span>
          <span class="value">{{propuesta.pesoKg}} kg</span>
        </div>

        <div class="info-row highlight">
          <span class="label">ğŸª™ Tokens calculados:</span>
          <span class="value tokens">{{propuesta.tokensCalculados}} REC</span>
        </div>
      </div>

      <!-- InformaciÃ³n blockchain -->
      <div class="blockchain-info" *ngIf="propuesta.transactionHash">
        <div class="info-row-small">
          <span class="label-small">TX Hash:</span>
          <span class="value-small">{{propuesta.transactionHash.substring(0, 20)}}...</span>
        </div>
        <div class="info-row-small">
          <span class="label-small">Bloque:</span>
          <span class="value-small">#{{propuesta.blockNumber}}</span>
        </div>
      </div>

      <!-- Botones de acciÃ³n -->
      <div class="actions">
        <button class="btn-aprobar" (click)="abrirFormularioAprobar(propuesta)">
          âœ… Aprobar
        </button>
        <button class="btn-rechazar" (click)="abrirFormularioRechazar(propuesta)">
          âŒ Rechazar
        </button>
      </div>

    </div>
  </div>

  <!-- Modal de formulario -->
  <div class="modal-overlay" *ngIf="mostrarFormulario" (click)="cerrarFormulario()">
    <div class="modal-content" (click)="$event.stopPropagation()">

      <div class="modal-header">
        <h2 *ngIf="accionSeleccionada === 'aprobar'">âœ… Aprobar Actividad #{{actividadSeleccionada?.actividadId}}</h2>
        <h2 *ngIf="accionSeleccionada === 'rechazar'">âŒ Rechazar Actividad #{{actividadSeleccionada?.actividadId}}</h2>
        <button class="btn-close" (click)="cerrarFormulario()">Ã—</button>
      </div>

      <div class="modal-body">

        <!-- Resumen de la actividad -->
        <div class="resumen-actividad">
          <p><strong>Usuario:</strong> {{actividadSeleccionada?.usuarioWallet}}</p>
          <p><strong>Material:</strong> {{getNombreMaterial(actividadSeleccionada?.tipoMaterial || '')}}</p>
          <p><strong>Peso:</strong> {{actividadSeleccionada?.pesoKg}} kg</p>
          <p><strong>Tokens:</strong> {{actividadSeleccionada?.tokensCalculados}} REC</p>
        </div>

        <!-- Formulario de validador -->
        <div class="form-group">
          <label for="wallet">ğŸ”‘ Wallet del Validador (ONG)</label>
          <input type="text" id="wallet" class="form-input" [(ngModel)]="walletAddress" placeholder="0x..." />
        </div>

        <div class="form-group">
          <label for="privateKey">ğŸ”’ Clave Privada (para firmar transacciÃ³n)</label>
          <input type="password" id="privateKey" class="form-input" [(ngModel)]="privateKey"
            placeholder="Clave privada del validador" />
          <small class="help-text">âš ï¸ Tu clave privada NUNCA se almacena, solo se usa para firmar la transacciÃ³n</small>
        </div>

        <!-- RazÃ³n de rechazo (solo para rechazar) -->
        <div class="form-group" *ngIf="accionSeleccionada === 'rechazar'">
          <label for="razon">ğŸ“ RazÃ³n del Rechazo</label>
          <textarea id="razon" class="form-textarea" [(ngModel)]="razonRechazo"
            placeholder="Explica por quÃ© se rechaza esta actividad..." rows="4"></textarea>
        </div>

      </div>

      <div class="modal-footer">
        <button class="btn-cancel" (click)="cerrarFormulario()">Cancelar</button>
        <button class="btn-confirmar" [class.btn-aprobar-confirm]="accionSeleccionada === 'aprobar'"
          [class.btn-rechazar-confirm]="accionSeleccionada === 'rechazar'" (click)="ejecutarAccion()">
          <span *ngIf="accionSeleccionada === 'aprobar'">âœ… Confirmar AprobaciÃ³n</span>
          <span *ngIf="accionSeleccionada === 'rechazar'">âŒ Confirmar Rechazo</span>
        </button>
      </div>

    </div>
  </div>

</div>