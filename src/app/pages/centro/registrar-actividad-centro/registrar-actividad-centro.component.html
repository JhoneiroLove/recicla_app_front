<div class="registro-container">
    <mat-card>
        <mat-card-header>
            <mat-card-title>游닍 Registrar Entrega de Reciclaje</mat-card-title>
            <mat-card-subtitle>Centro de Acopio UPAO</mat-card-subtitle>
        </mat-card-header>

        <mat-card-content>
            <form [formGroup]="actividadForm" (ngSubmit)="submitForm()">

                <!-- Wallet del Estudiante -->
                <mat-form-field appearance="outline" class="full-width">
                    <mat-label>Wallet del Estudiante</mat-label>
                    <input matInput formControlName="walletEstudiante" placeholder="0x...">
                    <button mat-icon-button matSuffix (click)="escanearQR()" type="button" matTooltip="Escanear QR">
                        <mat-icon>qr_code_scanner</mat-icon>
                    </button>
                    <mat-error *ngIf="actividadForm.get('walletEstudiante')?.hasError('required')">
                        La wallet es requerida
                    </mat-error>
                    <mat-error *ngIf="actividadForm.get('walletEstudiante')?.hasError('pattern')">
                        Formato de wallet inv치lido (debe empezar con 0x)
                    </mat-error>
                </mat-form-field>

                <!-- Tipo de Material -->
                <mat-form-field appearance="outline" class="full-width">
                    <mat-label>Tipo de Material</mat-label>
                    <mat-select formControlName="nombreResiduo">
                        <mat-option *ngFor="let residuo of residuos" [value]="residuo.nombre">
                            {{ residuo.nombre }} - {{ residuo.puntos }} puntos/kg
                        </mat-option>
                    </mat-select>
                    <mat-error *ngIf="actividadForm.get('nombreResiduo')?.hasError('required')">
                        Selecciona un tipo de material
                    </mat-error>
                </mat-form-field>

                <!-- Cantidad en kg -->
                <mat-form-field appearance="outline" class="full-width">
                    <mat-label>Peso (kg)</mat-label>
                    <input matInput type="number" formControlName="cantidad" placeholder="0.0" step="0.1">
                    <mat-icon matSuffix>scale</mat-icon>
                    <mat-error *ngIf="actividadForm.get('cantidad')?.hasError('required')">
                        El peso es requerido
                    </mat-error>
                    <mat-error *ngIf="actividadForm.get('cantidad')?.hasError('min')">
                        El peso m칤nimo es 0.1 kg
                    </mat-error>
                </mat-form-field>

                <!-- Evidencia Fotogr치fica -->
                <div class="upload-section">
                    <label class="upload-label">游닞 Evidencia Fotogr치fica</label>
                    <input type="file" (change)="onFileSelected($event)" accept="image/*" #fileInput class="file-input">
                    <button mat-raised-button color="accent" type="button" (click)="fileInput.click()">
                        <mat-icon>add_a_photo</mat-icon>
                        Seleccionar Imagen
                    </button>
                    <span *ngIf="imagenArchivo" class="file-name">{{ imagenArchivo.name }}</span>
                    <mat-error *ngIf="imageTouched && !imagenArchivo" class="error-message">
                        La imagen es requerida
                    </mat-error>
                </div>

                <!-- Botones -->
                <div class="button-container">
                    <button mat-raised-button color="primary" type="submit"
                        [disabled]="!actividadForm.valid || !imagenArchivo">
                        <mat-icon>check_circle</mat-icon>
                        Registrar Actividad
                    </button>
                    <button mat-raised-button color="warn" type="button" (click)="onReset()">
                        <mat-icon>cancel</mat-icon>
                        Limpiar
                    </button>
                </div>
            </form>
        </mat-card-content>
    </mat-card>

    <!-- Instrucciones -->
    <mat-card class="instrucciones-card">
        <mat-card-header>
            <mat-card-title>游늶 Instrucciones</mat-card-title>
        </mat-card-header>
        <mat-card-content>
            <ol>
                <li>Pesa el material reciclado del estudiante</li>
                <li>Escanea el c칩digo QR de la wallet del estudiante</li>
                <li>Selecciona el tipo de material entregado</li>
                <li>Ingresa el peso medido en la balanza</li>
                <li>Toma fotograf칤as de:
                    <ul>
                        <li>Material reciclado</li>
                        <li>Pantalla de la balanza mostrando el peso</li>
                        <li>C칩digo QR del estudiante</li>
                    </ul>
                </li>
                <li>Registra la actividad</li>
            </ol>
            <p class="nota">
                <mat-icon>info</mat-icon>
                La actividad quedar치 pendiente de validaci칩n por 2 ONGs antes de que el estudiante reciba sus tokens.
            </p>
        </mat-card-content>
    </mat-card>
</div>